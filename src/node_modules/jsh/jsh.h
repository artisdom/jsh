#ifndef READLINE_HPP
#define READLINE_HPP

#include <node.h>
#include <termios.h>
#include <unistd.h>
#include <sys/types.h>

class JSH : public node::ObjectWrap
{
public:
    static void init(v8::Handle<v8::Object> target);

    bool interactive() const { return interact; }
    pid_t pgid() const { return shellPgid; }
    termios* term() { return &shellTmodes; }

    v8::Persistent<v8::ObjectTemplate>& templ() { return termiosTemplate; }

private:
    JSH();
    ~JSH();

    void cleanup();

    static v8::Handle<v8::Value> New(const v8::Arguments& args);
    static v8::Handle<v8::Value> setupShell(const v8::Arguments& args);
    static v8::Handle<v8::Value> cleanup(const v8::Arguments& args);
    static v8::Handle<v8::Value> isExecutable(const v8::Arguments& args);
    static v8::Handle<v8::Value> execSync(const v8::Arguments& args);
    static v8::Handle<v8::Value> flockSync(const v8::Arguments& args);
    static v8::Handle<v8::Value> writeStdout(const v8::Arguments& args);
    static v8::Handle<v8::Value> writeStderr(const v8::Arguments& args);

private:
    bool interact;
    pid_t shellPgid;
    termios shellTmodes;

private:
    static v8::Persistent<v8::FunctionTemplate> constructor;
    v8::Persistent<v8::ObjectTemplate> termiosTemplate;
};

#endif
